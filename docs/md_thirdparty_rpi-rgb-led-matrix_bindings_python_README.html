<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TouchLED-Library: Python bindings for RGB Matrix library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TouchLED-Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Python bindings for RGB Matrix library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Building </h2>
<p>If you have a different than the standard wiring (for instance if you have an Adafruit HAT), you can edit the <a href="../../lib/Makefile#L26">../../lib/Makefile</a> first to choose the hardware in question (see below for setting it via command line argument).</p>
<p>Then, in the root directory for the matrix library simply type:</p>
<h3>Python 2</h3>
<div class="fragment"><div class="line">sudo apt-get update &amp;&amp; sudo apt-get install python2.7-dev python-pillow -y</div><div class="line">make build-python</div><div class="line">sudo make install-python</div></div><!-- fragment --><h3>Python 3</h3>
<p>You can also build for Python 3:</p>
<div class="fragment"><div class="line">sudo apt-get update &amp;&amp; sudo apt-get install python3-dev python3-pillow -y</div><div class="line">make build-python PYTHON=$(command -v python3)</div><div class="line">sudo make install-python PYTHON=$(command -v python3)</div></div><!-- fragment --><h3>PyPy</h3>
<p>The cython binding to PyPy seems to be somewhat working but extremely slow (20x slower even than the regular Python binding, 160x slower than C++), so this is not recommended.</p>
<p>So Cython is not good together with PyPy which works best with a <a href="https://cffi.readthedocs.io/">CFFI</a> binding.  did an experiment here <a href="https://github.com/Duality4Y/rgb-matrix-cffi">https://github.com/Duality4Y/rgb-matrix-cffi</a> which works well with PyPy and is about twice as fast as running Python3+cython (but Python3+cffi is slower than Python3+cython, so we can't just replace everything with cffi).</p>
<p>Of course, it would be nice to have the fastest possible binding to all kinds of Python interpreters. If anyone wants to work on that, this would certainly be a welcome pull request.</p>
<h2>Performance </h2>
<p>The simplicity of scripting comes at a price: Python is slower than C++ of course. If you have to do a lot of pixel updates in your demo, this can be too slow depending on what you do. Here are some rough numbers for calling <code>SetPixel()</code> in a tight loop:</p>
<ul>
<li>On a Pi-2 and Pi-3, a Python script will be about 1/8 of the speed compared to the corresponding C++ program (pushing ~0.43 Megapixels/s Python vs. ~3.5 Megapixels/s C++ on a Pi-3 for instance)</li>
<li>On a Pi-1/Pi Zero, the difference is even worse: 1/24 of the speed to the corresponding C++ program. Given that this Pi is already about 1/10 the speed of a Pi-3, this almost makes Python unusable on a Pi-1 (~0.015 Megapixels/s Python vs. ~0.36 Megapixels/s C++)</li>
<li>Also interesting: Python3 is a little bit slower than Python2.7. So if you can, stick with Python2.7 for now.</li>
<li>The good news is, that this is due to overhead per function call. If you can do more per function call, then this is less problematic. For instance if you have an image to be displayed with <code>SetImage()</code>, that will much faster per pixel (internally this then copies the pixels natively).</li>
</ul>
<p>The ~0.015 Megapixels/s on a Pi-1 means that you can update a 32x32 matrix at most with ~15fps. If you have chained 5, then you barely reach 3fps. In a Pi-3, you get about 400fps update rate (85fps for 5-chain) with a Python program (while with C++, you can do the same thing with a comfortable 3500fps (700fps for 5)). Keep in mind that this is if all you do is just calling <code>SetPixel()</code>, it does not include any time of what you actually want to do in your demo - so anything in addition to that will drop your update rate.</p>
<p>If you can prepare the animation you want to show, then you can either prepare images and then use the much faster call to <code>SetImage()</code>, or can fill entire offscreen-frames (create with <code>CreateFrameCanvas()</code>) and then swap with <code>SwapOnVSync()</code> (this is the fastest method).</p>
<h2>Using the library </h2>
<p>Be aware of the fact that using the full performance of the RGBMatrix requires root privileges. Therefore you should run all you python scripts as using <code>sudo</code>.</p>
<p>You may find examples in the <a href="./samples">samples/</a> subdirectory. The examples all use the <a href="./samples/samplebase.py">samplebase.py</a> that provides some basic capabilities to all example programs, such as command-line parsing: all sample-programs accept <code>--led-rows</code>, <code>--led-chain</code> and <code>--led-parallel</code> as command line options to adapt to your configuration</p>
<div class="fragment"><div class="line">cd samples</div><div class="line">sudo ./runtext.py --led-chain=4</div></div><!-- fragment --><p>To use different wiring without recompiling the library to change the default, you can use <code>--led-gpio-mapping</code> (or <code>-m</code>). For example, to use Adafruit HAT: </p><div class="fragment"><div class="line">sudo ./runtext.py --led-gpio-mapping=adafruit-hat</div></div><!-- fragment --><p>Here is a complete example showing how to write an image viewer: </p><div class="fragment"><div class="line">#!/usr/bin/env python</div><div class="line">import time</div><div class="line">import sys</div><div class="line"></div><div class="line">from rgbmatrix import RGBMatrix, RGBMatrixOptions</div><div class="line">from PIL import Image</div><div class="line"></div><div class="line">if len(sys.argv) &lt; 2:</div><div class="line">    sys.exit(&quot;Require an image argument&quot;)</div><div class="line">else:</div><div class="line">    image_file = sys.argv[1]</div><div class="line"></div><div class="line">image = Image.open(image_file)</div><div class="line"></div><div class="line"># Configuration for the matrix</div><div class="line">options = RGBMatrixOptions()</div><div class="line">options.rows = 32</div><div class="line">options.chain_length = 1</div><div class="line">options.parallel = 1</div><div class="line">options.hardware_mapping = &#39;regular&#39;  # If you have an Adafruit HAT: &#39;adafruit-hat&#39;</div><div class="line"></div><div class="line">matrix = RGBMatrix(options = options)</div><div class="line"></div><div class="line"># Make image fit our screen.</div><div class="line">image.thumbnail((matrix.width, matrix.height), Image.ANTIALIAS)</div><div class="line"></div><div class="line">matrix.SetImage(image.convert(&#39;RGB&#39;))</div><div class="line"></div><div class="line">try:</div><div class="line">    print(&quot;Press CTRL-C to stop.&quot;)</div><div class="line">    while True:</div><div class="line">        time.sleep(100)</div><div class="line">except KeyboardInterrupt:</div><div class="line">    sys.exit(0)</div></div><!-- fragment --><h2>API</h2>
<p>The source of truth for what is available in the Python bindings may be found <a href="rgbmatrix/core.pyx">here</a> (RGBMatrix, FrameCanvas, RGBMatrixOptions) and <a href="rgbmatrix/graphics.pyx">here</a> (graphics). The underlying implementation's ground truth documentation may be found <a href="../../include">here</a>, specifically for <a href="../../include/led-matrix.h">RGBMatrix, RGBMatrixOptions, and FrameCanvas</a>, <a href="../../include/canvas.h">Canvas</a> (base class of RGBMatrix), and <a href="../../include/graphics.h">graphics methods and Font</a>.</p>
<h3>User</h3>
<p>As noted in the Performance section above, Python programs not run as <code>root</code> will not be as high-performance as those run as <code>root</code>. When running as <code>root</code>, be aware of a potentially-unexpected behavior: to reduce the security attack surface, initializing an RGBMatrix as <code>root</code> changes the user from <code>root</code> to <code>daemon</code> (see <a href="https://github.com/hzeller/rpi-rgb-led-matrix/issues/1170">#1170</a> for more information) by default. This means, for instance, that some file operations possible before initializing the RGBMatrix will not be possible after initialization. To disable this behavior, set <code>drop_privileges=False</code> in RGBMatrixOptions, but be aware that doing so will reduce security. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
